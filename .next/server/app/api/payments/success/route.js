(()=>{var e={};e.id=7231,e.ids=[7231],e.modules={56037:e=>{"use strict";e.exports=require("mongoose")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79646:e=>{"use strict";e.exports=require("child_process")},55511:e=>{"use strict";e.exports=require("crypto")},94735:e=>{"use strict";e.exports=require("events")},81630:e=>{"use strict";e.exports=require("http")},55591:e=>{"use strict";e.exports=require("https")},28354:e=>{"use strict";e.exports=require("util")},7092:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>f,routeModule:()=>m,serverHooks:()=>S,workAsyncStorage:()=>y,workUnitAsyncStorage:()=>l});var s={};r.r(s),r.d(s,{POST:()=>d});var i=r(42706),n=r(28203),a=r(45994),u=r(39187),p=r(66993),o=r(25972);let c=new p.A(process.env.STRIPE_SECRET_KEY);async function d(e){try{let{session_id:t}=await e.json(),r=await c.checkout.sessions.retrieve(t);if("paid"===r.payment_status)return await (0,o.e)(t,"completed"),u.NextResponse.json({success:!0,redirect:`/payment/success?session_id=${t}`});return u.NextResponse.json({success:!1,redirect:"/payment/failed?error=Payment%20verification%20failed"})}catch(e){return console.error("Payment verification error:",e),u.NextResponse.json({success:!1,redirect:"/payment/failed?error=Payment%20verification%20failed"})}}let m=new i.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/payments/success/route",pathname:"/api/payments/success",filename:"route",bundlePath:"app/api/payments/success/route"},resolvedPagePath:"C:\\Users\\Administrator\\Desktop\\freelance_work_showcase\\app\\api\\payments\\success\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:y,workUnitAsyncStorage:l,serverHooks:S}=m;function f(){return(0,a.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:l})}},96487:()=>{},78335:()=>{},25972:(e,t,r)=>{"use strict";r.d(t,{A:()=>u,e:()=>p});var s=r(56037),i=r.n(s);let n=new(i()).Schema({userId:{type:i().Schema.Types.ObjectId,ref:"User",required:!0},serviceId:{type:i().Schema.Types.ObjectId,ref:"Service",required:!0},amount:{type:Number,required:!0},paymentStatus:{type:String,enum:["pending","completed","failed"],default:"pending"},stripeSessionId:{type:String,required:!0,unique:!0},customerName:{type:String,required:!0},customerAddress:{type:String,required:!0},currency:{type:String,default:"inr"},paymentMethod:{type:String,default:"card"},metadata:{type:Map,of:String,default:{}},errorCode:{type:String},errorMessage:{type:String},shipping:{name:String,address:{line1:String,country:{type:String,default:"IN"}}}},{timestamps:!0});n.statics.updatePaymentStatus=async function(e,t){return this.findOneAndUpdate({stripeSessionId:e},{paymentStatus:t},{new:!0})};let a=i().models.Payment||i().model("Payment",n),u=a,p=async(e,t)=>await a.updatePaymentStatus(e,t)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[1989,5452,6993],()=>r(7092));module.exports=s})();