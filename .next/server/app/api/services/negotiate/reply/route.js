(()=>{var e={};e.id=9582,e.ids=[9582],e.modules={56037:e=>{"use strict";e.exports=require("mongoose")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79646:e=>{"use strict";e.exports=require("child_process")},55511:e=>{"use strict";e.exports=require("crypto")},14985:e=>{"use strict";e.exports=require("dns")},94735:e=>{"use strict";e.exports=require("events")},29021:e=>{"use strict";e.exports=require("fs")},81630:e=>{"use strict";e.exports=require("http")},55591:e=>{"use strict";e.exports=require("https")},91645:e=>{"use strict";e.exports=require("net")},21820:e=>{"use strict";e.exports=require("os")},33873:e=>{"use strict";e.exports=require("path")},27910:e=>{"use strict";e.exports=require("stream")},34631:e=>{"use strict";e.exports=require("tls")},79551:e=>{"use strict";e.exports=require("url")},28354:e=>{"use strict";e.exports=require("util")},74075:e=>{"use strict";e.exports=require("zlib")},4651:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>f,routeModule:()=>l,serverHooks:()=>x,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{POST:()=>d});var i=t(42706),o=t(28203),n=t(45994),a=t(39187),p=t(43694),u=t(40984),c=t(68752);async function d(e){try{let r;let{negotiationId:t,message:s,offerAmount:i,isFromAdmin:o}=await e.json();if(!t||!s)return a.NextResponse.json({error:"Missing required fields"},{status:400});await (0,p.A)();let n=await u.A.findById(t);if(!n)return a.NextResponse.json({error:"Negotiation not found"},{status:404});n.replies.push({message:s,offerAmount:i,isFromAdmin:o,createdAt:new Date}),"pending"===n.status&&(n.status="negotiating"),await n.save();let d=o?"Response to Your Service Negotiation":"New Negotiation Message",l=`
        <div style="max-width: 700px; margin: 0 auto; padding: 40px 20px; font-family: 'Helvetica Neue', Arial, sans-serif; background-color: #ffffff;">
          <div style="background: linear-gradient(135deg, #1a1a1a 0%, #333333 100%); padding: 40px; border-radius: 16px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
            <img src="${process.env.NEXT_PUBLIC_APP_URL}/logo.png" alt="Dev Daim Logo" style="width: 180px; margin-bottom: 30px; filter: brightness(0) invert(1);"/>
            <h2 style="color: #ffffff; font-size: 28px; margin-bottom: 25px; font-weight: 600;">${d}</h2>
            <div style="background-color: rgba(255,255,255,0.95); padding: 30px; border-radius: 12px; border-left: 6px solid #00ff88; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
              <p style="color: #2c2c2c; line-height: 1.8; font-size: 16px; margin-bottom: 25px;">${s}</p>
              ${i?`<p style="color: #2c2c2c; font-size: 18px; font-weight: 600; margin-bottom: 25px;">Offered Amount: ${r=n.currency,new Intl.NumberFormat("en-US",{style:"currency",currency:r}).format(i)}</p>`:""}
            </div>
          </div>
          <div style="padding: 0 20px;">
            <p style="color: #2c2c2c; font-size: 16px; margin-bottom: 8px;">We'll get back to you soon with our response.</p>
            <p style="font-weight: 600; color: #1a1a1a; font-size: 20px; margin-bottom: 25px;">Dev Daim | Professional Development Solutions</p>
            <div style="margin-top: 25px; text-align: center;">
              <a href="https://wa.me/917889557560" style="display: inline-block; background: #1a1a1a; color: #ffffff; text-decoration: none; padding: 15px 30px; border-radius: 30px; font-weight: 600; margin: 0 10px; transition: all 0.3s ease;">Let's Discuss</a>
            </div>
          </div>
        </div>
    `;return await (0,c.s)({to:o?n.email:process.env.ADMIN_EMAIL,subject:d,html:l}),a.NextResponse.json(n,{status:200})}catch(e){return console.error("Error adding reply:",e),a.NextResponse.json({error:"Failed to add reply",details:e instanceof Error?e.message:"Unknown error occurred"},{status:500})}}let l=new i.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/services/negotiate/reply/route",pathname:"/api/services/negotiate/reply",filename:"route",bundlePath:"app/api/services/negotiate/reply/route"},resolvedPagePath:"C:\\Users\\Administrator\\Desktop\\freelance_work_showcase\\app\\api\\services\\negotiate\\reply\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:g,workUnitAsyncStorage:m,serverHooks:x}=l;function f(){return(0,n.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:m})}},96487:()=>{},78335:()=>{},43694:(e,r,t)=>{"use strict";t.d(r,{A:()=>n});var s=t(56037),i=t.n(s);if(!process.env.MONGODB_URI)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let o=process.env.MONGODB_URI,n=async function(){try{let e=await i().connect(o);return console.log("MongoDB connected successfully"),e}catch(e){throw console.error("Error connecting to MongoDB:",e),e}}},68752:(e,r,t)=>{"use strict";t.d(r,{s:()=>i});var s=t(98721);async function i({to:e,subject:r,text:t,html:i}){try{let o=s.createTransport({host:process.env.SMTP_HOST,port:Number(process.env.SMTP_PORT),secure:!0,auth:{user:process.env.SMTP_USER,pass:process.env.SMTP_PASSWORD}}),n=await o.sendMail({from:{name:"Response to Your Service Inquiry",address:process.env.SMTP_FROM_EMAIL},to:e,subject:r,text:t,html:i});return console.log("Email sent successfully:",n.messageId),n}catch(e){throw console.error("Error sending email:",e),Error("Failed to send email")}}},40984:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});var s=t(56037),i=t.n(s);let o=new s.Schema({message:{type:String,required:[!0,"Reply message is required"],trim:!0},offerAmount:{type:Number,min:[0,"Offer amount cannot be negative"]},isFromAdmin:{type:Boolean,required:!0,default:!1},createdAt:{type:Date,default:Date.now}}),n=new s.Schema({service:{type:s.Schema.Types.ObjectId,ref:"Service",required:[!0,"Service ID is required"]},name:{type:String,required:[!0,"Name is required"],trim:!0},email:{type:String,required:[!0,"Email is required"],trim:!0,lowercase:!0},phone:{type:String,trim:!0},budget:{type:Number,required:[!0,"Budget is required"],min:[0,"Budget cannot be negative"]},currency:{type:String,required:[!0,"Currency is required"],enum:["INR","USD","EUR"]},message:{type:String,required:[!0,"Message is required"],trim:!0,minlength:[10,"Message must be at least 10 characters long"]},status:{type:String,enum:["pending","negotiating","accepted","rejected","completed"],default:"pending"},replies:[o],finalAmount:{type:Number,min:[0,"Final amount cannot be negative"]}},{timestamps:!0}),a=i().models.Negotiation||i().model("Negotiation",n)}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[1989,5452,8721],()=>t(4651));module.exports=s})();